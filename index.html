<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <!-- ğŸ iOS å…¨å±ä¸çŠ¶æ€æ  -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> <!-- æ”¹è¿™é‡Œ -->
  <meta name="theme-color" content="rgba(0,0,0,0)">
  <title>Echo Garden</title>

  <!-- å¼•å…¥ manifest.json -->
  <link rel="manifest" href="js/manifest.json">
  <link rel="apple-touch-icon" sizes="512x512" href="assets/icons/icon512.png">
  <link rel="icon" href="assets/icons/icon512.png" type="image/png">
  <script src="js/main.js" defer></script>

</head>

<body>
  <img id="bg-layer" src="assets/bg/night.jpeg" alt="background">
  <button id="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ—</button>
  
<!-- === ä¿¡æ¯ç»„ä»¶ï¼ˆä¸Šä¸‹åˆ†åŒº + æŸ”å…‰ç»ç’ƒï¼‰ === -->
<div id="widget-dock">
  <div class="widget-card">

    <!-- é¡¶éƒ¨ï¼šç”µé‡åŒºï¼ˆå·¦åœ†ç¯ + å³èƒ¶å›Šæ¡ï¼‰ -->
    <div class="row top">
      <!-- å·¦ï¼šåœ†å½¢è¿›åº¦ç¯ -->
      <div class="ring">
        <svg width="56" height="56" viewBox="0 0 56 56">
          <circle class="bg" cx="28" cy="28" r="24"></circle>
          <circle class="fg" cx="28" cy="28" r="24"></circle>
        </svg>
        <span class="pct" id="batt-pct">--%</span>
      </div>

      <!-- å³ï¼šèƒ¶å›Šæ¡ -->
      <div class="pill">
        <span class="label">Battery</span>
        <strong id="batt-text">--%</strong>
      </div>
    </div>

    <!-- åº•éƒ¨ï¼šä¿¡æ¯åŒºï¼ˆå·¦å›¾/ä¸­ä¸¤è¡Œ/å³æ—¶é—´ï¼‰ -->
    <div class="row bottom">
      <img id="profile-img" class="avatar" src="assets/icons/sample.png" alt="avatar" />
      <div class="center">
        <div id="custom-text">DailyğŸ¤ âœ§Ëšâ‹†</div>
        <div class="sub"><span id="date"></span> Â· <span id="weekday"></span></div>
      </div>
      <div class="time" id="time">--:--</div>
    </div>

  </div>
</div>

<style>
/* å…³é”®ï¼šè®©ä¸»å±æˆä¸ºå®šä½å‚è€ƒå®¹å™¨ */
#homescreen { position: relative; }

/* åœé åŒºï¼šæ•´ä½“ä½ç½®ï¼ˆå¯æŒ‰éœ€å¾®è°ƒ topï¼‰ */
#widget-dock{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  top: calc(env(safe-area-inset-top) + 120px); /* ç½®äºä½ æ ‡çº¢é‚£å— */
  width:min(88vw, 360px);
  z-index:10;
}

/* å¤–å¡ç‰‡ï¼šæŸ”å…‰ç»ç’ƒ */
.widget-card{
  padding:14px 16px;
  border-radius:28px;
  background: rgba(255,255,255,0.14);
  backdrop-filter: blur(16px) saturate(150%);
  -webkit-backdrop-filter: blur(16px) saturate(150%);
  box-shadow:
    0 8px 24px rgba(0,0,0,0.18),
    inset 0 1px 0 rgba(255,255,255,0.35);
  color:#fff;
  font-family:"SF Pro Display","PingFang SC",sans-serif;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* é€šç”¨è¡Œ */
.row{ display:flex; align-items:center; justify-content:space-between; }

/* é¡¶éƒ¨è¡Œæ ·å¼ */
.row.top{
  background: rgba(255,255,255,0.20);
  border-radius:20px;
  padding:8px 10px;
  gap:12px;
}

/* åœ†ç¯ */
.ring{ position:relative; width:56px; height:56px; }
.ring svg{ transform:rotate(-90deg); }
.ring .bg{ fill:none; stroke:rgba(255,255,255,0.25); stroke-width:4; }
.ring .fg{
  fill:none; stroke:#fff; stroke-width:4; stroke-linecap:round;
  stroke-dasharray: 150; stroke-dashoffset: 150; /* ç”±JSæ§åˆ¶ */
  transition: stroke-dashoffset .5s ease;
  filter: drop-shadow(0 0 4px rgba(255,255,255,0.5));
}
.ring .pct{
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
  font-size:13px; font-weight:600; text-shadow:0 0 6px rgba(255,255,255,.45);
}

/* èƒ¶å›Šæ¡ */
.pill{
  display:flex; align-items:center; gap:8px;
  padding:8px 14px;
  border-radius:16px;
  background: rgba(255,255,255,0.18);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.35);
}
.pill .label{ font-size:13px; opacity:.9; }
.pill strong{ font-size:15px; }

/* åº•éƒ¨è¡Œ */
.row.bottom{
  background: rgba(255,255,255,0.16);
  border-radius:22px;
  padding:10px 12px;
  gap:12px;
}
.avatar{
  width:48px; height:48px; border-radius:50%;
  object-fit:cover;
  border:2px solid rgba(255,255,255,0.38);
  box-shadow:0 0 10px rgba(255,255,255,0.24);
}
.center{ flex:1; min-width:0; }
#custom-text{ font-size:16px; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.sub{ margin-top:3px; font-size:13px; opacity:.9; }
.time{ font-size:24px; font-weight:700; }
</style>

<script>
/* ---------- æ—¥æœŸæ—¶é—´ ---------- */
function updateTime() {
  const now = new Date();
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  document.getElementById("time").textContent = `${hours}:${minutes}`;
  
  // åˆ·æ–°åï¼Œç»§ç»­æ›´æ–°ä¸‹ä¸€å¸§
  requestAnimationFrame(updateTime);
}

// é¡µé¢åŠ è½½æ—¶å¼€å§‹æ›´æ–°
updateTime();

  document.addEventListener('visibilitychange', function() {
  if (!document.hidden) {
    updateTime();  // é¡µé¢å˜ä¸ºå¯è§æ—¶ï¼Œæ‰‹åŠ¨åˆ·æ–°ä¸€æ¬¡
  }
});


/* ---------- ç”µé‡ï¼šå¤šæ–¹æ¡ˆå…¼å®¹ ---------- */
function setBattery(level){
  level = Math.max(0, Math.min(100, Math.round(level)));
  const dash = 150 - (150*level)/100;
  const fg = document.querySelector('.ring .fg');
  if (fg) fg.style.strokeDashoffset = dash;
  const txt = `${level}%`;
  const el1 = document.getElementById('batt-pct');
  const el2 = document.getElementById('batt-text');
  if (el1) el1.textContent = txt;
  if (el2) el2.textContent = txt;
  localStorage.setItem('batteryFallback', String(level)); // è®°ä½ä¸€æ¬¡
}

// 1) æ ‡å‡† Battery APIï¼ˆiOS ä¸æ”¯æŒï¼‰
if (navigator.getBattery) {
  navigator.getBattery().then(b => {
    const sync = () => setBattery(b.level*100);
    sync(); b.addEventListener('levelchange', sync);
  });
} else {
  // 2) URL ä¼ å‚ï¼ˆé…åˆ iOS å¿«æ·æŒ‡ä»¤å¯è‡ªåŠ¨æ³¨å…¥ï¼Œå¦‚ ?battery=71ï¼‰
  const u = new URL(location.href);
  const q = u.searchParams.get('battery');
  if (q) setBattery(Number(q));
  else {
    // 3) æœ¬åœ°è®°å¿†/æ‰‹åŠ¨å…œåº•
    const saved = Number(localStorage.getItem('batteryFallback'));
    if (!isNaN(saved)) setBattery(saved);
    else setBattery(100); // åˆæ¬¡ç»™ä¸ªæ»¡ç”µå ä½
  }
}
</script>

  
  <!-- ä¸»å± -->
  <main id="homescreen">
    <div class="app-grid">
      <div class="app-icon" id="app-message" data-app="message">
  <img src="assets/icons/message.png" alt="æ¶ˆæ¯">
  <p>æ¶ˆæ¯</p>
</div>
      <div class="app-icon" data-app="diary"><img src="assets/icons/diary.png"><p>æ—¥è®°</p></div>
      <div class="app-icon" data-app="tarot"><img src="assets/icons/tarot.png"><p>å¡”ç½—</p></div>
      <div class="app-icon" data-app="forum"><img src="assets/icons/forum.png"><p>è®ºå›</p></div>
      <div class="app-icon" data-app="words"><img src="assets/icons/words.png"><p>å•è¯</p></div>
      <div class="app-icon" data-app="memo"><img src="assets/icons/memo.png"><p>å¿ƒå£°</p></div>
      <div class="app-icon" data-app="settings"><img src="assets/icons/settings.png"><p>è®¾ç½®</p></div>
    </div>
  </main>

  <section id="app-container" style="display:none;"></section>
  
<script src="js/script.js"></script>
</body>
</html>





















