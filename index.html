<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <!-- 🍎 iOS 全屏与状态栏 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="rgba(0,0,0,0)">
  <title>Echo Garden</title>

  <link rel="stylesheet" href="css/main.css"><!-- 保留你之前成功的样式 -->
  <link rel="apple-touch-icon" sizes="512x512" href="assets/icons/icon512.png">
  <link rel="icon" href="assets/icons/icon512.png" type="image/png">
  <script src="js/main.js" defer></script>

  <!-- 仅新增/覆盖必要样式：背景层、双页容器、Dock。不要动 .app-icon！ -->
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%; width: 100%;
      overflow: hidden;
      background: #000; /* 背景图未加载时的兜底色 */
    }
    /* 背景图层：固定铺满，处于页面最底但不是负 z-index（避免被根背景盖掉） */
    #bg-layer{
      position: fixed; inset: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      z-index: 0;
      pointer-events: none; user-select: none;
    }

    #theme-toggle{
      position: fixed;
      top: calc(env(safe-area-inset-top) + 8px);
      right: 14px;
      z-index: 3;
    }

    /* 双页横滑容器（主屏 + 右滑页） */
    #container{
      position: relative;
      z-index: 1;                 /* 在背景之上 */
      display: flex;
      width: 200%;
      min-height: 100dvh;         /* iOS 动态视口单位，防止整体上移 */
      transition: transform .4s ease;
    }
    .page{
      width: 50%;
      min-height: 100dvh;
      display: grid;
      place-items: center;
      /* 给底部留出 Dock 空间 */
      padding-bottom: calc(env(safe-area-inset-bottom) + 110px);
      /* 顶部安全区 */
      padding-top: calc(env(safe-area-inset-top) + 10px);
    }
    /* 切到右滑页 */
    #container.swiped{ transform: translateX(-50%); }

    /* Dock（唯一磨砂玻璃） */
    #dock{
      position: fixed;
      left: 50%;
      bottom: calc(env(safe-area-inset-bottom) + 20px);
      transform: translateX(-50%);
      z-index: 2;
      width: 230px; height: 74px;
      border-radius: 26px;
      background: rgba(255,255,255,0.2);
      -webkit-backdrop-filter: blur(20px) saturate(1.1);
      backdrop-filter: blur(20px) saturate(1.1);
      display: flex; align-items: center; justify-content: space-around;
    }
    #dock .dock-item{
      display: flex; flex-direction: column; align-items: center;
      gap: 4px;
    }
    #dock .dock-item img{ width: 40px; height: 40px; border-radius: 10px; }
    #dock .dock-item p{ color:#fff; font-size:12px; margin:0; }
  </style>
</head>

<body>
  <!-- 背景：保持你之前成功的实现 -->
  <img id="bg-layer" src="assets/bg/night.jpeg" alt="background" draggable="false">

  <button id="theme-toggle" aria-label="切换主题">🌗</button>

  <!-- 双页容器 -->
  <div id="container">
    <!-- 首页：剔除“消息/设置”，其它保持原样式（由 css/main.css 控制） -->
    <main class="page" id="home">
      <div class="app-grid">
        <div class="app-icon" data-app="diary"><img src="assets/icons/diary.png"><p>日记</p></div>
        <div class="app-icon" data-app="forum"><img src="assets/icons/forum.png"><p>论坛</p></div>
        <div class="app-icon" data-app="words"><img src="assets/icons/words.png"><p>单词</p></div>
        <div class="app-icon" data-app="memo"><img src="assets/icons/memo.png"><p>心声</p></div>
      </div>
    </main>

    <!-- 右滑页：只放“塔罗”，位置排在首页“消息”对应的第一格 -->
    <section class="page" id="right">
      <div class="app-grid">
        <div class="app-icon" data-app="tarot"><img src="assets/icons/tarot.png"><p>塔罗</p></div>
      </div>
    </section>
  </div>

  <!-- 固定 Dock（磨砂玻璃）：只放消息 & 设置 -->
  <div id="dock">
    <div class="dock-item" data-app="message"><img src="assets/icons/message.png"><p>消息</p></div>
    <div class="dock-item" data-app="settings"><img src="assets/icons/settings.png"><p>设置</p></div>
  </div>

  <!-- App 容器（保持你的结构） -->
  <section id="app-container" style="display:none;"></section>

  <script>
    // 简易左右滑动
    let startX = 0;
    const container = document.getElementById('container');
    addEventListener('touchstart', e => startX = e.touches[0].clientX, {passive:true});
    addEventListener('touchend',   e => {
      const endX = e.changedTouches[0].clientX;
      if (startX - endX > 80)  container.classList.add('swiped');    // 右滑到塔罗
      if (endX - startX > 80)  container.classList.remove('swiped'); // 左滑回主页
    }, {passive:true});
  </script>
</body>
</html>
